# Dependency Graph Visualizer

## 1. Общее описание

**Dependency Graph Visualizer** — это инструмент командной строки для генерации графов зависимостей npm-пакетов. Он использует Mermaid для визуализации зависимостей, включая транзитивные и циклические зависимости, и сохраняет результат в формате PNG.

Основные возможности:

- **Извлечение зависимостей без сторонних инструментов:** Получение информации о зависимостях происходит напрямую из npm-реестра с помощью HTTP-запросов, без использования `npm` или других внешних утилит.
- **Генерация графа зависимостей в формате Mermaid:** Преобразует полученные зависимости в формат, совместимый с Mermaid.
- **Сохранение графа в формате PNG:** Использует `@mermaid-js/mermaid-cli` для конвертации Mermaid-схемы в PNG-изображение.
- **Настройка глубины анализа зависимостей:** Позволяет установить максимальную глубину рекурсивного анализа зависимостей.

---

## 2. Описание функций и настроек

### Основные функции (из `graph_generator.py`):

- **`get_dependencies(package_name, max_depth)`**:
  
  Рекурсивно извлекает зависимости указанного npm-пакета с заданной глубиной. Использует HTTP-запросы к npm-реестру для получения информации о пакете. Возвращает граф зависимостей в виде словаря.

- **`generate_mermaid(graph)`**:
  
  Конвертирует граф зависимостей (словарь) в Mermaid-схему, которая может быть визуализирована с помощью Mermaid.

- **`save_mermaid_as_png(mermaid_code, output_file, graphviz_path)`**:
  
  Сохраняет Mermaid-схему в виде PNG-файла. Для этого используется `mmdc` (Mermaid CLI), который должен быть установлен и доступен по указанному пути.

- **`main()`**:
  
  Точка входа для запуска из командной строки. Парсит аргументы командной строки и запускает процесс извлечения зависимостей, генерации Mermaid-кода и сохранения в PNG.

### Настройки командной строки:

- `--graphviz-path` (обязательный):
  
  Путь к программе `mmdc` для визуализации графов. Обычно это `mmdc` или `mmdc.cmd` в Windows.

- `--package-name` (обязательный):
  
  Имя анализируемого npm-пакета.

- `--output-file` (обязательный):
  
  Путь для сохранения итогового PNG-файла.

- `--max-depth` (необязательный, по умолчанию 3):
  
  Максимальная глубина анализа зависимостей. Определяет, насколько глубоко будет происходить рекурсивный обход зависимостей.

**Пример команды:**

```bash
python graph_generator.py --graphviz-path "C:\Users\user\AppData\Roaming\npm\mmdc.cmd" \
    --package-name "express" --output-file "express_graph.png" --max-depth 2
```

---

## 3. Требования и установка

### Требования:

- **Python 3.7** или выше.
- **Node.js** и **npm** (для установки `@mermaid-js/mermaid-cli`).
- Установленный пакет **`@mermaid-js/mermaid-cli`** для конвертации Mermaid-схем в PNG.

### Установка зависимостей Python:

Если вы используете виртуальное окружение, активируйте его и установите необходимые пакеты:

```bash
pip install requests
```

---

## 4. Запуск проекта

### Запуск основного скрипта:

```bash
python graph_generator.py --graphviz-path "путь_к_mmdc" \
    --package-name "имя_пакета" --output-file "имя_файла.png" --max-depth глубина
```

**Пример:**

```bash
python graph_generator.py --graphviz-path "C:\Users\user\AppData\Roaming\npm\mmdc.cmd" \
    --package-name "lodash" --output-file "lodash_graph.png" --max-depth 2
```

### Пояснения:

- **`--graphviz-path`**: Укажите полный путь к исполняемому файлу `mmdc`. В Windows это может быть `"C:\Users\user\AppData\Roaming\npm\mmdc.cmd"`. В Unix-подобных системах обычно достаточно указать `"mmdc"`, если он находится в PATH.

- **`--package-name`**: Название npm-пакета, для которого вы хотите построить граф зависимостей.

- **`--output-file`**: Имя выходного файла PNG, куда будет сохранён граф.

- **`--max-depth`**: Максимальная глубина анализа зависимостей. По умолчанию 3. Увеличение этого значения может привести к более подробному графу, но потребует больше времени и ресурсов.

---

## 5. Запуск тестов

Для запуска тестов выполните команду:

```bash
python -m unittest test_graph_generator.py
```

---

## 6. Результаты прогона тестов

После запуска тестов вы должны увидеть вывод, аналогичный следующему:

```bash
Mermaid файл создан: test_graph1.mmd
Mermaid файл создан: test_graph2.mmd
Mermaid файл создан: test_graph_dependencies_1.mmd
Mermaid файл создан: test_graph_dependencies_2.mmd
Mermaid файл создан: test_graph_dependencies_3.mmd
.....
----------------------------------------------------------------------
Ran 7 tests in 0.025s

OK
```

Это означает, что все тесты прошли успешно.

---

## 7. Примечания

- **Ограничения:**

  - Инструмент не использует сторонние средства для получения зависимостей (требование задания). Все данные извлекаются напрямую из npm-реестра с помощью HTTP-запросов.
  - Для визуализации используется `@mermaid-js/mermaid-cli`, который должен быть установлен на вашем компьютере.

- **Совместимость:**

  - Проверено на Python 3.7 и выше.
  - Работает на Windows и Unix-подобных системах (при корректной настройке путей).

- **Рекомендации:**

  - При больших значениях `--max-depth` время выполнения программы может увеличиваться из-за большого количества запросов к npm-реестру.
  - Убедитесь, что у вас стабильное интернет-соединение, так как программа полагается на доступ к npm-реестру.

---

## 8. Пример использования

### Генерация графа зависимостей для пакета `express` с глубиной 2:

```bash
python graph_generator.py --graphviz-path "C:\Users\user\AppData\Roaming\npm\mmdc.cmd" \
    --package-name "express" --output-file "express_graph.png" --max-depth 2
```

**Вывод программы:**

```
Получение зависимостей для express...
Генерация Mermaid-схемы...
Сохранение графа зависимостей в PNG...
Mermaid файл создан: express_graph.mmd
Запуск команды: C:\Users\user\AppData\Roaming\npm\mmdc.cmd -i express_graph.mmd -o express_graph.png
PNG файл создан: express_graph.png
Граф зависимостей успешно сохранен в express_graph.png.
```

В результате в текущей директории появится файл `express_graph.png` с визуализацией зависимостей пакета `express`.

---
